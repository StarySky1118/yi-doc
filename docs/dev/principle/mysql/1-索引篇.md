# 1. 索引篇
索引是什么？怎么实现的？怎么用？

数据库索引利用额外的数据结构来组织数据，以空间换时间，加快查询速度。

## MySQL 索引是使用什么数据结构实现的？
MySQL InnoDB 存储引擎使用 B+ 树作为索引的数据结构，B+ 树是一种自平衡的多叉树，非叶子节点只存储索引，叶子节点存储数据。
并且叶子节点通过双向链表连接。
得益于这种数据结构，查询的时间复杂度为对数级，并且支持高效的范围查询。

## B+ 树查询数据的全过程是怎样的？
查询数据时，首先经过非叶子结点的索引抵达叶子结点。

叶子结点并非只有一条记录，而是一页记录，例如 16K，这是为满足空间局部性原理所做的一种配置。
一页记录有许多条记录，可以使用页目录，利用二分法查找记录所在分组。
再在分组中使用遍历的方式查找到指定记录。

## 索引的类型
可以根据使用的数据结构、字段性质划分以及字段个数进行划分。

根据使用的数据结构划分，可以分为 B+ 树索引、哈希索引、倒排索引和 R 树索引。

根据字段性质划分，可以分为主键索引、普通索引、唯一索引等。

根据字段个数划分，可以分为单字段索引和联合索引。

## 聚簇索引和非聚簇索引有什么区别
聚簇索引的索引字段是主键字段，非聚簇索引的索引字段是非主键字段。

聚簇索引的叶子结点存放完整记录，而非聚簇索引叶子结点仅存放索引列和主键值。

## MySQL 中的回表是什么
回表是指使用非聚簇索引进行查询时，由于非聚簇索引叶子结点仅存储了索引列和主键值，当需要获取其他字段的值，需要使用主键利用主键索引查询真实记录。

## MySQL 中覆盖索引是什么
覆盖索引是指非聚簇索引包含了查询所需的所有字段，不需要回表即可完成查询。

## 最左前缀匹配原则
最左前缀匹配原则是针对联合索引的一个原则，如果希望联合索引生效，那么查询条件必须符合联合索引的最左前缀。
例如 `(name, age)` 联合索引，查询条件 `name=xxx` 或 `name=xxx and age=xxx` 均可生效。`age=xxx` 无法生效。

## MySQL 中索引下推是什么？
索引下推是指在使用非聚簇索引时，非聚簇索引包含了过滤所需的全部字段，无需回表即可完成过滤。

## 索引使用注意事项
何时使用？何时不使用？
1. 频繁作为查询条件的字段适合建立索引
2. 经常出现在 `order by`、`group by` 等后面出现的字段适合建立索引
3. 数据量比较小的时候，添加索引可能得不偿失
4. 有大量重复值的字段不适合建立索引，若有大量重复值，即使建立索引，也会和全表扫描一样遍历差不多的记录数，同时带来额外开销，得不偿失

## 如何查看索引是否生效？
在 MySQL 中可以使用 `explain` 命令查看查询的执行计划。

结果中比较关键的字段是 `type`，常见值包括 `const`、`eq_ref`、`ref`、`range`、`index`、`ALL`。

可以根据 `type` 判断是否使用了索引。

## 索引在什么情况下会失效？
1. 对索引进行了运算或函数运算
2. 对索引使用左模糊或左右模糊匹配
3. 使用 `or` 连接查询条件时，某个条件无法使用索引
4. 使用联合索引没有遵循最左前缀匹配

