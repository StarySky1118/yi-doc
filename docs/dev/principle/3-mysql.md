# MySQL

## MySQL 慢查询

MySQL 慢查询是指查询时间超过阈值的查询语句。MySQL 提供了慢查询日志记录这些超过阈值的查询。

可以使用 `explain`命令查询语句的执行计划，比较重要的字段是 `type`和 `extra`。`type` 表示查询方式，常见值有 `ALL`（全表扫描）、`index`（对二级索引进行遍历）、`range`（索引范围）、`ref`（非唯一索引多个）、`eq_ref`（通常出现在多表联查，唯一索引）和 `const`（主键查、唯一索引查）。

可以使用 `type`判断索引是否对查询起到了优化作用。

`extra`值有 `Using filesort`（无法使用索引排序，使用了排序算法进行排序）、`Using index`从二级索引中获取到了所需字段值无需回表、`Using Temporary`使用临时表存储中间结果。

## MySQL 一张表能存放多少数据

MySQL InnoDB 引擎一条记录最大字节长度为 65535，即 64KB。若硬盘大小为 64G，则最多存储 100 万条记录。

## 说说 MySQL 事务？幻读是什么？何时出现幻读？

MySQL InnoDB 存储引擎是支持事务的，默认隔离级别是可重复读，即在一个事务中，多次查询同一条记录得到的结果是一致的。

幻读是指在事务中，符合条件的记录数改变了。

当事务期间其他事务 `insert`，本事务 `update`时，本事务并不会根据 MVCC 的可见性判断记录是否可见，而是直接修改该记录，多出了一条自己修改的记录，导致幻读。

## 索引有哪些分类？

按照字段类型分类，可分为主键索引、唯一索引、普通索引、前缀索引。
按照字段个数分类，可分为单列索引和联合索引。

## 索引有哪些优点或缺点？

索引优点：

1. 提高查询速度

缺点：

1. 占用物理存储空间
2. 在插入、删除、更新数据时会增加额外开销

## MySQL 中的三大日志及作用

MySQL 中的三大日志包括 Undo Log、Redo Log 和 binlog。

Undo Log 存储了记录修改之前的状态，用于事务的回滚操作和多版本并发控制机制。

Redo Log 记录了数据页的修改操作，通过 Redo Log 可以将修改数据写入磁盘，实现持久性。

binlog 是一种逻辑日志，记录了 SQL 语句的内容，可以使用 binlog 实现数据备份、主从复制和数据恢复。

## 常见索引失效场景

1. 对索引使用函数或表达式

如果对索引使用函数或表达式，索引会失效。

2. 对索引字段使用左模糊或左右模糊匹配

3. where 子句中使用了 or，并且某个条件无法使用索引

4. 使用联合索引，没有遵循最左匹配原则，因为记录会根据联合索引中从左到右出现的每个字段进行排序

## 常见的 SQL 优化方案

常见的 SQL 优化方案包括索引优化、查询优化、配置优化等。

索引优化是指在频繁查询的列上创建索引、使用覆盖索引减小回表；
查询优化包括避免使用 Select *，只选择必要的列，减少数据传输、合理使用多表联查、减少子查询等；
配置优化包括根据硬件条件和工作负载，调整数据库连接池、日志等配置。
