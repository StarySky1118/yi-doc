# 3. 事务
事务的特性包括 ACID，即原子性、一致性、隔离性和持久性。

Redis 执行命令使用单线程模型，因此无需实现隔离性。
仅需实现原子性和持久性。

## 原子性
为实现事务原子性，可以使用 lua 脚本或 Redis 事务。

Redis 在接收到 lua 脚本后，会持续执行其中的命令直至结束，中间不会执行其他命令，因此 lua 脚本可以实现多命令执行的原子性。

Redis 事务通过 `MULTI-EXEC` 使用，也可以保证多条命令执行的原子性。

但两种方式都没有失败回滚机制。

## 持久性
Redis 有两种持久化机制：AOF 日志和 RDB 快照。

AOF 日志的原理是：每进行一次写操作，就将该命令以**顺序写**的方式写入 AOF 日志。
重启 Redis 时，就可以通过执行日志中的所有命令进行恢复。
该种方式与 MySQL Redo Log 十分类似。

RDB 快照的原理是：每隔一段时间，拍摄内存快照，重启时使用这个内存快照进行恢复。

两种方式各有优缺点。

AOF 日志可以通过配置，在每次写操作后都进行 AOF 写入，以实现可靠的持久性，但这样会降低写操作的执行效率。
同时，大量写操作后，AOF 日志中的内容会非常多，占用大量磁盘空间，并且恢复时十分耗时。

RDB 快照方式，如果拍摄快照间隔较大，持久性的可靠性就比较低。
