import{_ as n,c as s,o as a,a as p}from"./app-REenseam.js";const e="/yi-doc/images/dev/java/third_party_in/S3.png",t={},l=p('<h1 id="aws-s3" tabindex="-1"><a class="header-anchor" href="#aws-s3"><span>AWS S3</span></a></h1><h2 id="服务概述" tabindex="-1"><a class="header-anchor" href="#服务概述"><span>服务概述</span></a></h2><p>AWS S3 提供了 Java SDK，使用 Java SDK 进行鉴权、使用服务。</p><h2 id="接入流程" tabindex="-1"><a class="header-anchor" href="#接入流程"><span>接入流程</span></a></h2><p>新建一个模块，无需包含启动类。 <img src="'+e+`" alt="image.png"><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>包含需要引入的配置 bean。内容如下：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span>FileAutoConfiguration</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line"> *    Copyright (c) 2018-2025, lengleng All rights reserved.</span>
<span class="line"> *</span>
<span class="line"> * Redistribution and use in source and binary forms, with or without</span>
<span class="line"> * modification, are permitted provided that the following conditions are met:</span>
<span class="line"> *</span>
<span class="line"> * Redistributions of source code must retain the above copyright notice,</span>
<span class="line"> * this list of conditions and the following disclaimer.</span>
<span class="line"> * Redistributions in binary form must reproduce the above copyright</span>
<span class="line"> * notice, this list of conditions and the following disclaimer in the</span>
<span class="line"> * documentation and/or other materials provided with the distribution.</span>
<span class="line"> * Neither the name of the pig4cloud.com developer nor the names of its</span>
<span class="line"> * contributors may be used to endorse or promote products derived from</span>
<span class="line"> * this software without specific prior written permission.</span>
<span class="line"> * Author: lengleng (wangiegie@gmail.com)</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FileProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>local<span class="token punctuation">.</span></span><span class="token class-name">LocalFileAutoConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OssAutoConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OssProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">EnableConfigurationProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * aws 自动配置类</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@author</span> lengleng</span>
<span class="line"> * <span class="token keyword">@author</span> 858695266</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">LocalFileAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">OssAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">FileProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">OssProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.deye.ems.cloud.common.file.oss.service&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileAutoConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><code>@Import</code>用于在配置类中引入其他配置类。在引入的配置类中可以定义 bean。</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line"> *    Copyright (c) 2018-2025, lengleng All rights reserved.</span>
<span class="line"> *</span>
<span class="line"> * Redistribution and use in source and binary forms, with or without</span>
<span class="line"> * modification, are permitted provided that the following conditions are met:</span>
<span class="line"> *</span>
<span class="line"> * Redistributions of source code must retain the above copyright notice,</span>
<span class="line"> * this list of conditions and the following disclaimer.</span>
<span class="line"> * Redistributions in binary form must reproduce the above copyright</span>
<span class="line"> * notice, this list of conditions and the following disclaimer in the</span>
<span class="line"> * documentation and/or other materials provided with the distribution.</span>
<span class="line"> * Neither the name of the pig4cloud.com developer nor the names of its</span>
<span class="line"> * contributors may be used to endorse or promote products derived from</span>
<span class="line"> * this software without specific prior written permission.</span>
<span class="line"> * Author: lengleng (wangiegie@gmail.com)</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>local</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FileProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FileTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnMissingBean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnProperty</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * aws 自动配置类</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@author</span> lengleng</span>
<span class="line"> * <span class="token keyword">@author</span> 858695266</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@AllArgsConstructor</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalFileAutoConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">FileProperties</span> properties<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token annotation punctuation">@Bean</span></span>
<span class="line">	<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">LocalFileTemplate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;file.local.enable&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">FileTemplate</span> <span class="token function">localFileTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LocalFileTemplate</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ol><li><code>**@ConditionalOnMissingBean(LocalFileTemplate.class)**</code><strong>：</strong><ul><li>作用：此条件注解的作用是仅在容器中不存在类型为<code>**LocalFileTemplate**</code>的 bean 时，才创建当前的 bean。如果已经存在名为<code>**LocalFileTemplate**</code>的 bean，则当前的 bean 不会被创建。这样可以防止重复创建相同类型的 bean。</li></ul></li><li><code>**@ConditionalOnProperty(name = &quot;file.local.enable&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)**</code><strong>：</strong><ul><li>作用：此条件注解的作用是仅在配置文件中存在名为<code>**file.local.enable**</code>的属性，且其值为 <code>true</code> 时，才创建当前的 bean。<code>**matchIfMissing = true**</code>表示如果没有配置该属性，则也满足条件。这样可以根据配置文件中的属性值来决定是否创建这个 bean。</li></ul></li></ol></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line"> *    Copyright (c) 2018-2025, lengleng All rights reserved.</span>
<span class="line"> *</span>
<span class="line"> * Redistribution and use in source and binary forms, with or without</span>
<span class="line"> * modification, are permitted provided that the following conditions are met:</span>
<span class="line"> *</span>
<span class="line"> * Redistributions of source code must retain the above copyright notice,</span>
<span class="line"> * this list of conditions and the following disclaimer.</span>
<span class="line"> * Redistributions in binary form must reproduce the above copyright</span>
<span class="line"> * notice, this list of conditions and the following disclaimer in the</span>
<span class="line"> * documentation and/or other materials provided with the distribution.</span>
<span class="line"> * Neither the name of the pig4cloud.com developer nor the names of its</span>
<span class="line"> * contributors may be used to endorse or promote products derived from</span>
<span class="line"> * this software without specific prior written permission.</span>
<span class="line"> * Author: lengleng (wangiegie@gmail.com)</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FileProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FileTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">OssEndpoint</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">OssTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnMissingBean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnProperty</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Primary</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * aws 自动配置类</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@author</span> lengleng</span>
<span class="line"> * <span class="token keyword">@author</span> 858695266</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@AllArgsConstructor</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssAutoConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">FileProperties</span> properties<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token annotation punctuation">@Bean</span></span>
<span class="line">	<span class="token annotation punctuation">@Primary</span></span>
<span class="line">	<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">OssTemplate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;file.oss.enable&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">FileTemplate</span> <span class="token function">ossTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OssTemplate</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token annotation punctuation">@Bean</span></span>
<span class="line">	<span class="token annotation punctuation">@ConditionalOnMissingBean</span></span>
<span class="line">	<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;file.oss.info&quot;</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">OssEndpoint</span> <span class="token function">ossEndpoint</span><span class="token punctuation">(</span><span class="token class-name">OssTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OssEndpoint</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>**@Primary**</code>注解用于标识一个 Spring Bean 在存在多个相同类型的候选 Bean 时具有优先权。在你的代码中，<code>**@Primary**</code>注解标注在<code>**ossTemplate()**</code>方法上，表示当容器中存在多个类型为<code>**FileTemplate**</code>的 Bean 时，优先选择使用当前方法所创建的<code>**ossTemplate**</code>Bean。</p></blockquote><p>在使用时，我的配置如下：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">file</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">bucketName</span><span class="token punctuation">:</span> ess<span class="token punctuation">-</span>ota <span class="token comment"># 上文创建的桶名称</span></span>
<span class="line">  <span class="token key atrule">oss</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> s3.cn<span class="token punctuation">-</span>northwest<span class="token punctuation">-</span>1.amazonaws.com.cn</span>
<span class="line">    <span class="token key atrule">accessKey</span><span class="token punctuation">:</span> xxx</span>
<span class="line">    <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> xxx</span>
<span class="line">    <span class="token key atrule">region</span><span class="token punctuation">:</span> cn<span class="token punctuation">-</span>northwest<span class="token punctuation">-</span><span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因此会创建<code>OssTemplate</code>bean。</p><ol start="2"><li><code>@EnableConfigurationProperties({ FileProperties.class, OssProperties.class })</code>配置类注入。</li></ol><p>并且<code>FileProperties</code>是包含<code>OssProperties</code>的。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line"> *    Copyright (c) 2018-2025, lengleng All rights reserved.</span>
<span class="line"> *</span>
<span class="line"> * Redistribution and use in source and binary forms, with or without</span>
<span class="line"> * modification, are permitted provided that the following conditions are met:</span>
<span class="line"> *</span>
<span class="line"> * Redistributions of source code must retain the above copyright notice,</span>
<span class="line"> * this list of conditions and the following disclaimer.</span>
<span class="line"> * Redistributions in binary form must reproduce the above copyright</span>
<span class="line"> * notice, this list of conditions and the following disclaimer in the</span>
<span class="line"> * documentation and/or other materials provided with the distribution.</span>
<span class="line"> * Neither the name of the pig4cloud.com developer nor the names of its</span>
<span class="line"> * contributors may be used to endorse or promote products derived from</span>
<span class="line"> * this software without specific prior written permission.</span>
<span class="line"> * Author: lengleng (wangiegie@gmail.com)</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>local<span class="token punctuation">.</span></span><span class="token class-name">LocalFileProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OssProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 文件 配置信息</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@author</span> lengleng</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * bucket 设置公共读权限</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Data</span></span>
<span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileProperties</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">	 * 默认的存储桶名称</span>
<span class="line">	 */</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> bucketName <span class="token operator">=</span> <span class="token string">&quot;local&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">	 * 本地文件配置信息</span>
<span class="line">	 */</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">LocalFileProperties</span> local<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">	 * oss 文件配置信息</span>
<span class="line">	 */</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">OssProperties</span> oss<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line"> *    Copyright (c) 2018-2025, lengleng All rights reserved.</span>
<span class="line"> *</span>
<span class="line"> * Redistribution and use in source and binary forms, with or without</span>
<span class="line"> * modification, are permitted provided that the following conditions are met:</span>
<span class="line"> *</span>
<span class="line"> * Redistributions of source code must retain the above copyright notice,</span>
<span class="line"> * this list of conditions and the following disclaimer.</span>
<span class="line"> * Redistributions in binary form must reproduce the above copyright</span>
<span class="line"> * notice, this list of conditions and the following disclaimer in the</span>
<span class="line"> * documentation and/or other materials provided with the distribution.</span>
<span class="line"> * Neither the name of the pig4cloud.com developer nor the names of its</span>
<span class="line"> * contributors may be used to endorse or promote products derived from</span>
<span class="line"> * this software without specific prior written permission.</span>
<span class="line"> * Author: lengleng (wangiegie@gmail.com)</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * aws 配置信息</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@author</span> lengleng</span>
<span class="line"> * <span class="token keyword">@author</span> 858695266 配置文件添加： oss: enable: true endpoint: http://127.0.0.1:9000 #</span>
<span class="line"> * pathStyleAccess 采用nginx反向代理或者AWS S3 配置成true，支持第三方云存储配置成false pathStyleAccess: false</span>
<span class="line"> * access-key: lengleng secret-key: lengleng bucket-name: lengleng region: custom-domain:</span>
<span class="line"> * https://oss.xxx.com/lengleng</span>
<span class="line"> * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"> * bucket 设置公共读权限</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Data</span></span>
<span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;oss&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssProperties</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 对象存储服务的URL</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 自定义域名</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> customDomain<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * true path-style nginx 反向代理和S3默认支持 pathStyle <span class="token punctuation">{</span>http://endpoint/bucketname<span class="token punctuation">}</span> false</span>
<span class="line">	 * supports virtual-hosted-style 阿里云等需要配置为 virtual-hosted-style</span>
<span class="line">	 * 模式<span class="token punctuation">{</span>http://bucketname.endpoint<span class="token punctuation">}</span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">Boolean</span> pathStyleAccess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 应用ID</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> appId<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 区域</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> region<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * Access key就像用户ID，可以唯一标识你的账户</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> accessKey<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * Secret key是你账户的密码</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> secretKey<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 最大线程数，默认： 100</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">Integer</span> maxConnections <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><code>@ComponentScan(basePackages = &quot;com.deye.ems.cloud.common.file.oss.service&quot;)</code>组件扫描</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line"> *    Copyright (c) 2018-2025, lengleng All rights reserved.</span>
<span class="line"> *</span>
<span class="line"> * Redistribution and use in source and binary forms, with or without</span>
<span class="line"> * modification, are permitted provided that the following conditions are met:</span>
<span class="line"> *</span>
<span class="line"> * Redistributions of source code must retain the above copyright notice,</span>
<span class="line"> * this list of conditions and the following disclaimer.</span>
<span class="line"> * Redistributions in binary form must reproduce the above copyright</span>
<span class="line"> * notice, this list of conditions and the following disclaimer in the</span>
<span class="line"> * documentation and/or other materials provided with the distribution.</span>
<span class="line"> * Neither the name of the pig4cloud.com developer nor the names of its</span>
<span class="line"> * contributors may be used to endorse or promote products derived from</span>
<span class="line"> * this software without specific prior written permission.</span>
<span class="line"> * Author: lengleng (wangiegie@gmail.com)</span>
<span class="line"> */</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>file<span class="token punctuation">.</span>oss<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span></span><span class="token class-name">ClientConfiguration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span><span class="token class-name">AWSCredentials</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span><span class="token class-name">AWSCredentialsProvider</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span><span class="token class-name">AWSStaticCredentialsProvider</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>auth<span class="token punctuation">.</span></span><span class="token class-name">BasicAWSCredentials</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>client<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">AwsClientBuilder</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span></span><span class="token class-name">AmazonS3</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span></span><span class="token class-name">AmazonS3Client</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>s3<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IOUtils</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FileProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>deye<span class="token punctuation">.</span>ems<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">FileTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Cleanup</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">RequiredArgsConstructor</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">SneakyThrows</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * aws-s3 通用存储操作 支持所有兼容s3协议的云存储: <span class="token punctuation">{</span>阿里云OSS，腾讯云COS，七牛云，京东云，minio 等<span class="token punctuation">}</span></span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@author</span> lengleng</span>
<span class="line"> * <span class="token keyword">@author</span> 858695266</span>
<span class="line"> * <span class="token keyword">@date</span> 2020/5/23 6:36 上午</span>
<span class="line"> * <span class="token keyword">@since</span> 1.0</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@RequiredArgsConstructor</span></span>
<span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssTemplate</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">FileTemplate</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">FileProperties</span> properties<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">AmazonS3</span> amazonS3<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 获取配置信息</span>
<span class="line">	 * <span class="token keyword">@return</span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">FileProperties</span> <span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> properties<span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 创建bucket</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createBucket</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>amazonS3<span class="token punctuation">.</span><span class="token function">doesBucketExistV2</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			amazonS3<span class="token punctuation">.</span><span class="token function">createBucket</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 获取全部bucket</span>
<span class="line">	 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 *</span>
<span class="line">	 * <span class="token keyword">@see</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/ListBuckets<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AWS</span>
<span class="line">	 * API Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bucket</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> amazonS3<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@see</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/ListBuckets<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AWS</span>
<span class="line">	 * API Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bucket</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> amazonS3<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>b <span class="token operator">-&gt;</span> b<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@see</span> &lt;a href=</span>
<span class="line">	 * &quot;http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/DeleteBucket&quot;&gt;AWS API</span>
<span class="line">	 * Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeBucket</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		amazonS3<span class="token punctuation">.</span><span class="token function">deleteBucket</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 根据文件前置查询文件</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">prefix</span> 前缀</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">recursive</span> 是否递归查询</span>
<span class="line">	 * <span class="token keyword">@return</span> S3ObjectSummary 列表</span>
<span class="line">	 * <span class="token keyword">@see</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/ListObjects<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AWS</span>
<span class="line">	 * API Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S3ObjectSummary</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAllObjectsByPrefix</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> prefix<span class="token punctuation">,</span> <span class="token keyword">boolean</span> recursive<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token class-name">ObjectListing</span> objectListing <span class="token operator">=</span> amazonS3<span class="token punctuation">.</span><span class="token function">listObjects</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> prefix<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>objectListing<span class="token punctuation">.</span><span class="token function">getObjectSummaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 获取文件外链</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> 文件名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">expires</span> 过期时间 &lt;=7</span>
<span class="line">	 * <span class="token keyword">@return</span> url</span>
<span class="line">	 * <span class="token keyword">@see</span> <span class="token reference"><span class="token class-name">AmazonS3</span><span class="token punctuation">#</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Date</span> expiration<span class="token punctuation">)</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getObjectURL</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token class-name">Integer</span> expires<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token class-name">Calendar</span> calendar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		calendar<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		calendar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_MONTH</span><span class="token punctuation">,</span> expires<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token class-name">URL</span> url <span class="token operator">=</span> amazonS3<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> calendar<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 获取文件</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> 文件名称</span>
<span class="line">	 * <span class="token keyword">@return</span> 二进制流</span>
<span class="line">	 * <span class="token keyword">@see</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/GetObject<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AWS</span>
<span class="line">	 * API Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">S3Object</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">return</span> amazonS3<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 上传文件</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> 文件名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">stream</span> 文件流</span>
<span class="line">	 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token class-name">InputStream</span> stream<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> stream<span class="token punctuation">,</span> stream<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;application/octet-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 上传文件</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> 文件名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">stream</span> 文件流</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">contextType</span> 文件类型</span>
<span class="line">	 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token class-name">InputStream</span> stream<span class="token punctuation">,</span> <span class="token class-name">String</span> contextType<span class="token punctuation">)</span></span>
<span class="line">			<span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> stream<span class="token punctuation">,</span> stream<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> contextType<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 上传文件</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> 文件名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">stream</span> 文件流</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">size</span> 大小</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">contextType</span> 类型</span>
<span class="line">	 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span></span>
<span class="line">	 * <span class="token keyword">@see</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/PutObject<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AWS</span>
<span class="line">	 * API Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">PutObjectResult</span> <span class="token function">putObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">,</span> <span class="token class-name">InputStream</span> stream<span class="token punctuation">,</span> <span class="token keyword">long</span> size<span class="token punctuation">,</span></span>
<span class="line">			<span class="token class-name">String</span> contextType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// String fileName = getFileName(objectName);</span></span>
<span class="line">		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token class-name">ObjectMetadata</span> objectMetadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		objectMetadata<span class="token punctuation">.</span><span class="token function">setContentLength</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		objectMetadata<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>contextType<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token class-name">ByteArrayInputStream</span> byteArrayInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token comment">// 上传</span></span>
<span class="line">		<span class="token keyword">return</span> amazonS3<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">,</span> byteArrayInputStream<span class="token punctuation">,</span> objectMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 获取文件信息</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> 文件名称</span>
<span class="line">	 * <span class="token keyword">@see</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/GetObject<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AWS</span>
<span class="line">	 * API Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token class-name">S3Object</span> <span class="token function">getObjectInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token annotation punctuation">@Cleanup</span></span>
<span class="line">		<span class="token class-name">S3Object</span> object <span class="token operator">=</span> amazonS3<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">return</span> object<span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token doc-comment comment">/**</span>
<span class="line">	 * 删除文件</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">bucketName</span> bucket名称</span>
<span class="line">	 * <span class="token keyword">@param</span> <span class="token parameter">objectName</span> 文件名称</span>
<span class="line">	 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span></span>
<span class="line">	 * <span class="token keyword">@see</span> &lt;a href=</span>
<span class="line">	 * &quot;http://docs.aws.amazon.com/goto/WebAPI/s3-2006-03-01/DeleteObject&quot;&gt;AWS API</span>
<span class="line">	 * Documentation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">	 */</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span><span class="token class-name">String</span> bucketName<span class="token punctuation">,</span> <span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span></span>
<span class="line">		amazonS3<span class="token punctuation">.</span><span class="token function">deleteObject</span><span class="token punctuation">(</span>bucketName<span class="token punctuation">,</span> objectName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token annotation punctuation">@Override</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token comment">// AWS 客户端配置</span></span>
<span class="line">		<span class="token class-name">ClientConfiguration</span> clientConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		clientConfiguration<span class="token punctuation">.</span><span class="token function">setMaxConnections</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getOss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMaxConnections</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token comment">// 指定 S3 存储服务端点配置</span></span>
<span class="line">		<span class="token class-name">AwsClientBuilder<span class="token punctuation">.</span>EndpointConfiguration</span> endpointConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AwsClientBuilder<span class="token punctuation">.</span>EndpointConfiguration</span><span class="token punctuation">(</span></span>
<span class="line">				properties<span class="token punctuation">.</span><span class="token function">getOss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> properties<span class="token punctuation">.</span><span class="token function">getOss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token comment">// 配置凭证</span></span>
<span class="line">		<span class="token class-name">AWSCredentials</span> awsCredentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicAWSCredentials</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getOss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAccessKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">				properties<span class="token punctuation">.</span><span class="token function">getOss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSecretKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token class-name">AWSCredentialsProvider</span> awsCredentialsProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWSStaticCredentialsProvider</span><span class="token punctuation">(</span>awsCredentials<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token comment">// 创建客户端</span></span>
<span class="line">		<span class="token keyword">this</span><span class="token punctuation">.</span>amazonS3 <span class="token operator">=</span> <span class="token class-name">AmazonS3Client</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">.</span><span class="token function">withEndpointConfiguration</span><span class="token punctuation">(</span>endpointConfiguration<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">.</span><span class="token function">withClientConfiguration</span><span class="token punctuation">(</span>clientConfiguration<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">.</span><span class="token function">withCredentials</span><span class="token punctuation">(</span>awsCredentialsProvider<span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">.</span><span class="token function">disableChunkedEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">.</span><span class="token function">withPathStyleAccessEnabled</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getOss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPathStyleAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">			<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>当一个类实现了 Spring 框架中的<code>**InitializingBean**</code>接口时，它需要实现接口中的 <code>**afterPropertiesSet**</code>方法。这个接口提供了一种在 bean 属性设置完毕后执行自定义初始化逻辑的机制。具体而言，<code>**InitializingBean**</code>接口的主要作用是在 Spring 容器完成 bean 属性的设置后，调用 <code>**afterPropertiesSet()**</code>方法，从而让 bean 执行一些初始化操作。 上述代码便在 bean 属性设置完毕后配置 S3 客户端。</p></blockquote>`,22),c=[l];function i(o,u){return a(),s("div",null,c)}const k=n(t,[["render",i],["__file","2-AWS_S3.html.vue"]]),d=JSON.parse('{"path":"/dev/java/third_party_in/2-AWS_S3.html","title":"AWS S3","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"服务概述","slug":"服务概述","link":"#服务概述","children":[]},{"level":2,"title":"接入流程","slug":"接入流程","link":"#接入流程","children":[]}],"git":{"updatedTime":1721523858000,"contributors":[{"name":"ZhangZiYi","email":"ecustzzy1@163.com","commits":1}]},"filePathRelative":"dev/java/third_party_in/2-AWS_S3.md"}');export{k as comp,d as data};
